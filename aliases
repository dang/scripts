# .ALIASES -- script that sets up many handy command shortcuts.
# Called from ".TCSHRC" file.
#
# Created by Daniel Gryniewicz 

#
# Make sure extended globbing is on
shopt -s extglob

#
# cd
#alias cd="pushd"
alias cd..="cd .."
#
# ls
alias ls="/bin/ls -s -h --color=auto"
alias la="ls -a"
alias ll="ls -al"
#
# cp
alias cp="cp --sparse=always"
#
# df
alias df="df -h"
#
# grep
alias grep='egrep --color=auto'
alias egrep='egrep --color=auto'
#
# du
alias diskusage='sudo du -mx --max-depth 1 . | sort -g'
#
# control
alias j="jobs -l"
# Linux only
alias ps="/bin/ps -o user,pid,ppid,class,nice,nlwp,sgi_p,start,stat,tty,rss,cputime,args ww"
function psg {
				ps --pid $(pgrep -d, -f $*)
		}
#function psg {
#                ps auwwx | head -1;
#                ps auwwx | grep $* | grep -v grep;
#		}
function psu {
				ps --pid $(pgrep -d, -u $*)
		}
function pspid {
				ps --pid $*
		}
alias pss="ps ax | sort | more"
alias psme="psu $USER"
alias psall="ps ax"
function smem {
				smem.pl $(pidof $*)
		}
function schedtype {
	schedtool $(pgrep -d, -f $*)
	}
function schedretype {
	MODE=$1
	shift
	sudo schedtool ${MODE} $(pgrep -d, -f $*)
	}
#function slay {
#                set j=`ps ax|grep $*|head -1`; kill -9 `echo $j[1]`;
#							}
alias slay="echo use pkill"
alias nuke="kill -9"
alias x="exit"
alias lo="logout"
#
# utilities
alias md="mkdir -p"
alias rd="rmdir"
alias which="alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde"
#alias mktar="tar -cvf"
#alias mktbz="tar -cjvf"
#alias mktgz="tar -czvf"
function mktbz {
	if [ -z "$1" ]; then
		echo "Usage: mktbz <directory> [<tbzname>]"
		return 1
	fi
	DIRNAME="$1"
	if [ -n "$2" ]; then
		TBZNAME="$2"
	else
		TBZNAME="${DIRNAME%/}.tar.bz2"
	fi
	${SUDO} tar -cjf "${TBZNAME}" "${DIRNAME}"
}
function mktgz {
	if [ -z "$1" ]; then
		echo "Usage: mktgz <directory> [<tbzname>]"
		return 1
	fi
	DIRNAME="$1"
	if [ -n "$2" ]; then
		TGZNAME="$2"
	else
		TGZNAME="${DIRNAME%/}.tar.gz"
	fi
	${SUDO} tar -czf "${TGZNAME}" "${DIRNAME}"
}
#alias untar="tar -xvf"
#alias untgz="tar zxf"
#alias untbz="tar jxf"
alias untar="echo Use duntarball"
#alias mktar="echo Use duntarball"
alias untgz="echo Use duntarball"
alias untbz="echo Use duntarball"
#function untbz {
#                bzip2 -cd $* | tar xfv -;
#		}
alias rezip="gunzip *.gz && bzip2 *.tar"
function manf {
                nroff -man $* | $MANPAGER;
		}
# For some reason, the new terminfo entries don't work
#alias man="TERM=xterm-old man"
function ws {
                w $* |sort|more;
		}
# alias whois="/usr/ucb/whois -h rs.internic.net"
if [ $SHELL = "/bin/ksh" ]; then
	unalias rm
fi
alias diff='/usr/bin/diff --exclude-from="${HOME}/.scripts/diffrc" -up'
# The bloody bc does *integer* math be default!
alias bc="bc -l"
#
# gotta have it
export ALIASFILES="${HOME}/.scripts/aliases"
function new {
	for i in ${ALIASFILES}; do
		source $i
	done
}
#
# Terminal Reset Command -- Fixes screen when it gets messy (ie. wierd font)
function terr
	{
	echo "c";
	stty echo
	}

alias cvs="colorcvs"
#
# Dan"s personal aliases. These come and go, and are specific to the system.
#
function mpgcat {
	cat $@ | mencoder -noidx -ovc copy -oac copy -o output.mpg -
}
#function 2avi {
#	mencoder  "$1" -idx -ovc divx4 -oac mp3lame -o "$2"
#}
alias ripdvd="mencoder -dvd 1 -alang en -ovc lavc -lavcopts vcodec=mpeg4:vhq:vbitrate=1800 -oac copy -vop scale -zoom -xy 640 -o "
function ripdvd2pass {
		mencoder dvd://$1 -alang en -ovc lavc -lavcopts vcodec=mpeg4:vbitrate=1000:mbd=0:vpass=1:vqmin=2:vqmax=31:turbo:autoaspect -vop lavcdeint -oac copy $3 $4 -o $2
		mencoder dvd://$1 -alang en -ovc lavc -lavcopts vcodec=mpeg4:vbitrate=1000:mbd=0:vpass=2:vqmin=2:vqmax=31:autoaspect -vop lavcdeint -oac copy $3 $4 -o $2
	}
function ripdvd2passmp3 {
		mencoder dvd://$1 -alang en -ovc lavc -vop lavcdeint -lavcopts vcodec=mpeg4:vbitrate=1000:mbd=0:vpass=1:vqmin=2:vqmax=31:turbo:autoaspect -oac mp3lame $3 $4 -o $2
		mencoder dvd://$1 -alang en -ovc lavc -vop lavcdeint -lavcopts vcodec=mpeg4:vbitrate=1000:mbd=0:vpass=2:vqmin=2:vqmax=31:autoaspect -oac mp3lame $3 $4 -o $2
	}
#function ripdvd2pass {
#		mencoder -dvd 1 -alang en -ovc lavc -lavcopts vcodec=mpeg4:vhq:vbitrate=1800 -oac copy -vop scale -zoom -xy 640 -o $* -pass 1
#		mencoder -dvd 1 -alang en -ovc lavc -lavcopts vcodec=mpeg4:vhq:vbitrate=1800 -oac copy -vop scale -zoom -xy 640 -o $* -pass 2
#	}
alias mp='mplayer -alang eng -osdlevel 3'
alias mpsub='mplayer -alang eng -slang eng -osdlevel 3'
#alias dvd="mp -ni -alang en dvd://"
function dvd {
	TITLE=$1
	shift
	mp -alang en dvd://${TITLE} $@
	}
function dvddeint {
	TITLE=$1
	shift
	mp -vf pp=ci dvd://${TITLE} $@
	}
function dvdiso {
	TITLE=$1
	shift
	mp dvd://${TITLE} -dvd-device $@
	}
alias vcd="mp vcd://1 -ni -alang en"
#alias vcd="mp -vo xv -ao sdl -vcd 1 -framedrop -ni -nofs"
#alias vcd="mp -vcd 1"
#alias mp='mplayer'
alias mp2="mp -vf scale=w=2:h=-2 -zoom"
function mpmulti {
	for i in $@; do
		mp -fs $i
	done
}
alias mpdeint="mp -vf pp=ci"
# These are the aliases for things that need root.
alias reboot="sudo shutdown -r now"
alias halt="sudo shutdown -h now"
function suspend {
	# Lock the screen (must be done as me)
	gnome-screensaver-command -l
	#sudo /home/dang/bin/suspend
	sudo pm-suspend --auto-quirks --quirk-dpms-on
}
#alias suspend="sudo /home/dang/bin/suspend"
alias wakeup="sudo kbdrate -r 30"

#
# These are just useful aliases, in no specific order
# alias edit="vim"
alias vim="TERM=xterm-256color vim"
alias :e="vim"
alias gvim="gvim -geometry 90x53"
function html {
                links -dump -force-html $* | less
		}
alias sprt="enscript --media=Letter -2 -j -G -B --landscape --margins=::40:40"
eval `dircolors -b ${HOME}/.scripts/dir_colors` # set up color-ls variables
unset autologout
alias telent=telnet

# CD burning
alias burn="sudo cdrecord -tao -v -eject dev=/dev/cdrom -isosize"
alias burnslow="sudo cdrecord -tao -v -eject dev=/dev/cdrom speed=0 -isosize"
alias burnrw="sudo cdrecord -tao -v -eject dev=/dev/cdrom blank=fast speed=24 -isosize"

# All the common rsync commands
alias backup="rsync --rsh=ssh -avzS --progress --delete "
#alias backup="( rsync --rsh=ssh -avzS --delete --delete-excluded --exclude=\"vmware\" --exclude=\"tmp\" --exclude=\".ccache\" --exclude=\"Cache\" --exclude=\"xxx\" --exclude=\"Downloads\" /home/dang/ zeus:/home/dang )"

##
# These are development related aliases.
function cppgrep {
	find . "(" -name "*.c" -or -name "*.cpp" ")" -exec grep --color=auto -H "$@" "{}" ";"
}
function hppgrep {
	find . "(" -name "*.h" -or -name "*.hpp" ")" -exec grep --color=auto -H "$@" "{}" ";"
}
function chppgrep {
	find . "(" -name "*.[ch]" -or -name "*.[ch]pp" ")" -exec grep --color=auto -H "$@" "{}" ";"
}
function cgrep {
	find . -name "*.c" -exec grep --color=auto -H "$@" "{}" ";"
}
function chgrep {
	find . -name "*.[ch]" -exec grep --color=auto -H "$@" "{}" ";"
}
function hgrep {
	find . -name "*.h" -exec grep --color=auto -H "$@" "{}" ";"
}
function dgrep {
	PATTERN=$1
	shift
	find . -name "*${PATTERN}*" -exec grep --color=auto -H "$@" "{}" ";"
}
function igrep {
	PATTERN=$1
	shift
	find . -iname "*${PATTERN}*" -exec grep --color=auto -H "$@" "{}" ";"
}
function grepall {
	find . -regextype posix-extended ! \( -regex '.*cscope.*' -o -regex '.*tags.*' -o -regex '.*\.orig' -o -regex '.*\.rej' -o -regex '.*CVS.*' -o -regex '.*\.#maketags.dfg' -o -regex '.*\.svn.*' -o -regex '.*\.git.*' \) -exec grep --color=auto -H "$@" "{}" ";"
}
function cleanuppatch {
	find . -name "*.orig" -exec rm {} \;
	find . -name "*.rej" -exec rm {} \;
}
function vimreject {
	vim -O ${1}?(.rej)
}

# Gentoo related aliases
# Don't alias emerge; toolsched doesn't work with sudo
#alias emerge="sudo emerge"
alias eix-sync='sudo eix-sync'
#alias eworld='emerge -auvD --reinstall changed-use world'
alias eworld='emerge -auvDN world'
alias unmerge='emerge --unmerge'
alias eresume='emerge --resume'
alias eskipfirst='emerge --resume --skipfirst'
function echeck {
	if [ -z "$1" ]; then
		TARGET="world"
	else
		TARGET="$1"
	fi
	emerge -puvDN ${TARGET} | grep "=>0"
}
alias etc-update='sudo etc-update'
alias edistmon='DISTCC_DIR=/home/portage/portage/.distcc distccmon-gnome'
alias schedbatch='sudo schedtool -D -e sudo -u dang'
alias schediso='sudo schedtool -I -e sudo -u dang'


alias genpatch="svnpatchset /home/portage/overlays/gentopia/ /home/dang/tmp/gentopia-patches"

function emailstable() {
	grep KEYWORD $1 | sed 's/KEYWORDS="//' | sed 's/"//' | sed 's/ /\n/g' | awk '(/~/) {printf "%s@gentoo.org, ", $0} END {printf "\n"}' | sed 's/~//g'
}

alias webcol="webcollage -root -v > $HOME/.webcollage 2>/dev/null </dev/null &"
function ntpfix {
	sudo /etc/init.d/ntpd stop
	sudo /etc/init.d/ntp-client restart
	sudo /etc/init.d/ntpd start
}
function pcmciastart {
	sudo /etc/init.d/pcmcia zap
	sleep 1
	sudo /etc/init.d/pcmcia start
}

function ipwfix {
	sudo /etc/init.d/net.eth1 stop
	sleep 4
	sudo /etc/init.d/net.eth1 start
}

function ipwkick {
	sudo /etc/init.d/net.eth1 stop
	sudo rmmod ipw2200
	sleep 4
	sudo modprobe ipw2200
}

alias screenshot="import -frame"
function resize {
	convert -scale 450x450 "$1" "$1";
}

alias netfix="sudo /etc/init.d/net.eth1 restart"
alias gamespeed="sudo speedfreq -p 800"
alias keyfix="xmodmap ${HOME}/.scripts/keymap"
alias danosmount="sudo losetup /dev/loop/0 /home/dang/src/danos/kernel/image/image; sudo mount /dev/loop/0 /home/dang/src/danos/kernel/image/mnt"
alias danosumount="sudo umount /home/dang/src/danos/kernel/image/mnt; sudo losetup -d /dev/loop/0"

alias thanatosvnc="vncviewer -via nemesis.fprintf.net thanatos.fprintf.net:1"
alias poseidonvnc="vncviewer -via nemesis.fprintf.net poseidon.fprintf.net:1"

function cookiegrep {
	grep $@ ${HOME}/.mozilla/firefox/4rl18vit.default/hostperm.1
}

alias cookieedit="vim ${HOME}/.mozilla/firefox/4rl18vit.default/hostperm.1"

alias display="display -auto-orient"
alias xv="display -geometry +0+0 -resize 1432x870"

function reniceX {
	sudo renice -12 -p $(pgrep X)
}

function reniceevo {
#	renice-X
	sudo renice -10 -p $(pgrep evolution)
}

# play simialar artists...
function last_fm_similar {
	artist=$(echo $* | sed 's/ /+/g')
	shell-fm lastfm://artist/${artist}/similarartists
}

# gpg times out a lot, when getting keys from keyservers; run in a loop
function gpg_get_key {
	rv=$(gpg --recv-key $*)
	while [ -z "${rv}" ]; do
		echo "try again"
		rv=$(gpg --recv-key $*)
	done
}

function screen_named {
	SCREENNAME=${1}
	shift
	screen -S ${SCREENNAME} -t ${SCREENNAME} $@
}

function git_add_modified {
	git add $(git status | grep modified | awk '{print $3}')
}

function git_tar ()
{
    local name=$(pwd)
    name=${name##*/}

    if [ ! "$1" ]; then
        echo "[ERROR] what branch to export?"
	return 1
    fi

    local date=$(TZ=UTC date '+%Y%m%d')
    local pkg="$name-$date"
    local dir=".."
    local tar="$dir/$pkg.tar.gz"

    git archive \
        --format=tar \
        --prefix="$pkg/" \
        "$@" |
    gzip --best > "$tar"

    echo $tar
}

alias qdepends="qdepends -Q"

alias ps_mem="sudo ${HOME}/bin/ps_mem.py"

alias storage="sshfs nemesis.fprintf.net:/storage /storage"

#Get the list of devices and the associated kernel drivers
alias kernel_drivers="lspci -nnk"
