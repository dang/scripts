#!/bin/bash

# Set usage output
USAGE="[-hfn]"
LONGUSAGE="\t-h\tPrint this help message
\t-f\tFast update (no metadata regen)
\t-n\tSkip updating overlays"

# Standard functions
source ${SCRIPTS}/functions.sh

ECVSUPARGS=""
# Parse arguments
while getopts ":hfn" option; do
       case ${option} in
               f ) ECVSUPARGS="${ECVSUPARGS} -f";;
               n ) ECVSUPARGS="${ECVSUPARGS} -n";;
               h ) usage;;
               \? ) usage "Invalid argument ${OPTARG}";;
               * ) usage "Invalid argument ${option}";;
       esac
done

if [ "${OPTIND}" != "0" ]; then
       shift $((OPTIND-1))
fi

${SCRIPTS}/ecvsup ${ECVSUPARGS} || die "Error during ecvsup"
tmpfile=$(mktemp)
sudo cp /var/cache/eix ${tmpfile} || die "Error while copying cache-file to a save location."
sudo update-eix                         || die "Problems with update-eix."
sudo diff-eix ${tmpfile} || die "Error while diffing."
sudo rm -f ${tmpfile} || die "Couldn't remove ${tmpfile}"
exit 0
